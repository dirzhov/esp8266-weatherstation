/*!
main.js
version : 1.0.0
authors : Dmitry Irzhov
license : MIT */
;$(document).ready(function(){var g=window.location;window.host=g.protocol!=""?g.protocol+"//":"";window.host=g.host!=""?window.host+g.host:"";window.host=g.port!=""?window.host+":"+g.port+"/":"";if(window.host==""){window.host="http://192.168.1.85/"}window.chartColors={red:"rgb(255,99,132)",orange:"rgb(255,159,64)",yellow:"rgb(255,205,86)",green:"rgb(75,192,192)",blue:"rgb(54,162,235)",purple:"rgb(153,102,255)",grey:"rgb(201,203,207)"};var p=Chart.helpers.color,c="DD HH:mm:ss",q="MM/DD/YY HH:mm:ss",h=5;var u={type:"line",data:{labels:[],datasets:[{label:"Temperature(C)",fill:true,backgroundColor:p(window.chartColors.blue).alpha(0.2).rgbString(),borderColor:window.chartColors.blue,data:[]},{label:"Temperature(F)",fill:true,backgroundColor:p(window.chartColors.green).alpha(0.2).rgbString(),borderColor:window.chartColors.green,data:[],hidden:true},{label:"Humidity(%)",fill:true,backgroundColor:p(window.chartColors.red).alpha(0.2).rgbString(),borderColor:window.chartColors.red,data:[]},{label:"Light(%)",fill:true,backgroundColor:p(window.chartColors.yellow).alpha(0.2).rgbString(),borderColor:window.chartColors.yellow,data:[]}]},options:{responsive:true,tooltips:{mode:"index",intersect:false},hover:{mode:"nearest",intersect:true},scales:{xAxes:[{type:"time",time:{format:c,tooltipFormat:"ll HH:mm"},scaleLabel:{display:true,labelString:"Date"}}],yAxes:[{display:true,scaleLabel:{display:true,labelString:"Value"}}]}}};var s={type:"line",data:{labels:[],datasets:[{label:"Light(%)",fill:true,backgroundColor:p(window.chartColors.blue).alpha(0.2).rgbString(),borderColor:window.chartColors.blue,data:[]}]},options:{responsive:true,tooltips:{mode:"index",intersect:false},hover:{mode:"nearest",intersect:true},scales:{xAxes:[{type:"time",time:{format:c,tooltipFormat:"ll HH:mm"},scaleLabel:{display:true,labelString:"Date"}}],yAxes:[{display:true,scaleLabel:{display:true,labelString:"Value(%)"}}]}}};var f={type:"line",data:{labels:[],datasets:[{label:"Temperature(C)",fill:true,backgroundColor:p(window.chartColors.blue).alpha(0.2).rgbString(),borderColor:window.chartColors.blue,data:[]},{label:"Temperature(F)",fill:true,backgroundColor:p(window.chartColors.green).alpha(0.2).rgbString(),borderColor:window.chartColors.green,data:[],hidden:true},{label:"Humidity(%)",fill:true,backgroundColor:p(window.chartColors.red).alpha(0.2).rgbString(),borderColor:window.chartColors.red,data:[]},{label:"Light(%)",fill:true,backgroundColor:p(window.chartColors.yellow).alpha(0.2).rgbString(),borderColor:window.chartColors.yellow,data:[]}]},options:{responsive:true,tooltips:{mode:"index",intersect:false},hover:{mode:"nearest",intersect:true},scales:{xAxes:[{type:"time",time:{format:q,tooltipFormat:"ll HH:mm"},scaleLabel:{display:true,labelString:"Date"}}],yAxes:[{display:true,scaleLabel:{display:true,labelString:"Value"}}]}}};var n=document.getElementById("tempChart");n.width=$(n).parent().width();n.height=$(n).parent().height();var r=new Chart(n,u);var o=document.getElementById("lightChart");o.width=$(o).parent().width();o.height=$(o).parent().height();var j=new Chart(o,s);var m=document.getElementById("weekChart");m.width=$(m).parent().width();m.height=$(m).parent().height();var b=new Chart(m,f);var l=document.getElementById("monthChart");l.width=$(l).parent().width();l.height=$(l).parent().height();var i=new Chart(l,f);var t=function(v,w){switch(v){case 0:return parseFloat(w.c);break;case 1:return parseFloat(w.c*1.8+32);break;case 2:return parseFloat(w.h);break;case 3:return parseFloat(w.l/1024*100);break}return NaN};var a=function(){$.ajax({type:"GET",url:host+"temp",dataType:"json",success:function(z){if(u.data.datasets.length<=0){return}if(u.data.labels.length>50){for(var x=0;x<u.data.datasets.length;++x){u.data.datasets[x].data.shift()}u.data.labels.shift()}var A=moment(),y=A.clone().add(h,"s").format(c);u.data.labels.push(y);var w;for(var x=0;x<u.data.datasets.length;++x){u.data.datasets[x].data.push({x:y,y:t(x,z)})}r.update()},error:function(w,v){console.log("%s %s",w,v)}})};var e=function(){$.ajax({type:"GET",url:host+"light",dataType:"json",success:function(w){if(s.data.labels.length>50){s.data.datasets[0].data.shift();s.data.labels.shift()}var x=moment(),v=x.clone().add(h,"s").format(c);s.data.labels.push(v);s.data.datasets[0].data.push({x:v,y:parseFloat(w.v)});j.update()},error:function(w,v){console.log("%s %s",w,v)}})};var d=function(w,v){$.ajax({type:"GET",url:host+v,dataType:"json",success:function(A){f.data.labels=[];for(var x=0;x<f.data.datasets.length;++x){f.data.datasets[x].data=[]}var B=moment().subtract(A.d,"milliseconds"),z=B.clone();for(var y=0;y<A.v.length;y++){z=z.add(A.i,A.iu);f.data.labels.push(z);for(var x=0;x<f.data.datasets.length;++x){f.data.datasets[x].data.push({x:z.format(q),y:t(x,A.v[y])})}}w.update()},error:function(y,x){console.log("%s %s",y,x)}})};window.timerTempId=setInterval(a,h*1000);window.timerLightId=setInterval(e,h*1000);var k=function(w,v){v.data.labels=[];v.data.datasets.forEach(function(x,y){while(x.data.length>0){x.data.pop()}});w.update()};$("#clear_temp").click(function(){k(r,u)});$("#clear_light").click(function(){k(j,s)});$(".tabscontent").tabbedContent({links:"a.r-tabs-anchor",onSwitch:function(w,v){if(w=="#tab-1"){r.update()}else{if(w=="#tab-2"){j.update()}else{if(w=="#tab-3"){d(b,"week")}else{if(w=="#tab-4"){d(i,"month")}}}}}});$.getJSON(host+"connectionInfo",function(w,v){if(w==null){return}$("#ip").text(w.ip);$("#ssid").text(w.ssid)})});